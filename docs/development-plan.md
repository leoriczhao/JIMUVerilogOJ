# JIMU Verilog OJ 开发计划

## 指导原则
- **质量优先**：先补齐测试、监控和文档，保持 `make check` 与 API 文档的同步。
- **增量迭代**：以 2~3 周为节奏推进，每次交付可验证的功能或改进。
- **自动化支撑**：每条主干功能配套 CI、测试、脚本，降低后续维护成本。
- **单一责任**：各服务仅处理自身领域逻辑，通过 OpenAPI/消息队列通信。

## 总体里程碑
| 里程碑 | 目标 | 关键输出 |
| --- | --- | --- |
| M0: 基线稳定 (进行中) | 让现有功能可部署、可用、可测试 | CI 策略、环境变量梳理、最小化文档更新 |
| M1: 管理端完善 | Admin 端 API/前端可支持日常运营 | 完整权限模型、审计日志、基础 UI |
| M2: 用户体验提升 | 面向选手的完整做题体验 | 前端题库/提交流程、判题反馈、错误提示 |
| M3: 扩展与可观测 | 系统可支撑更多题目与用户 | 判题弹性扩展、监控告警、性能优化 |

## 工作流拆分

### 1. 后端服务 (`/backend`)
- **M0**
  - 梳理现有对外 API，补齐 OpenAPI 文档缺失项并回传到 `docs/openapi`。
  - 对关键 handler/service 增加单元测试与表格驱动测试。
  - 引入统一日志/错误响应格式，补充健康检查与 readiness 探针。
- **M1**
  - 设计并实现 Admin 专属路由、RBAC 权限、活动审计日志。
  - 管理员操作（题目、公告、用户）的事务处理与幂等保障。
- **M2**
  - 打通选手提交流程：提交 → 排队 → 判题结果回写。
  - 优化通知机制（WebSocket/长轮询）向前端推送判题状态。
- **M3**
  - 性能基准测试 (bench + wrk) 并制定扩容策略。
  - 接入 Prometheus 指标、集中式日志（ELK/ Loki）方案。

### 2. 管理端前端 (`/admin-frontend`)
- **M0**
  - 清理脚手架，补齐 ESLint/Prettier/Vitest 配置与 CI。
  - 定义 API 客户端层与权限守卫，确保登录流程贯通。
- **M1**
  - 构建题库、用户、公告管理页面，采用 Element Plus 组件。
  - 加入操作回滚或确认机制，避免误操作。
- **M2**
  - 实现仪表盘与统计视图，与后端统计接口联动。
  - 增加端到端测试（Playwright/Cypress）覆盖关键操作。

### 3. 业务前端 (`/frontend`)
- **M0**
  - 与 `docs` API 定义对齐，生成 TypeScript SDK。
  - 完成登录/注册、题目列表、题目详情的基础流程。
- **M1**
  - 实现代码编辑、测试数据展示、提交记录页。
  - 接入判题状态实时刷新（WebSocket or SSE）。
- **M2**
  - 增强用户体验：错误提示、草稿自动保存、题解/讨论整合。
  - 引入 Lighthouse/性能指标检查。

### 4. 判题服务 (`/judge-service`)
- **M0**
  - 梳理消息格式，统一与后端的提交/结果协议。
  - 为沙箱执行与资源限制添加测试和配置模板。
- **M1**
  - 引入任务重试、死信队列、防止判题卡死。
  - 输出判题用例管理工具（批量导入/校验）。
- **M2**
  - 支持更多评测模式（仿真波形比对、性能计分）。
  - 增加调度策略（优先级、并发配额）。

### 5. 文档与运维 (`/docs`, `/docker`, `/scripts`)
- 维护架构、API 规范与部署手册，与代码同步审查。
- 对齐环境变量说明 (`docs/environment.md`)，补充 `.env.example`。
- 优化 `docker-compose.dev.yml` 一键启动脚本，增加日志/数据卷说明。
- 完善部署脚本：预检 (`lint`/`fmt`)、数据迁移、回滚策略。

## 近期冲刺（未来 2 周）
1. 调整 CI（已完成 PR 中），补充后端 `make check` 执行文档，并验证在 PR 中强制执行。
2. 梳理后端现有接口，对照 `docs/openapi` 列出缺失项，形成 backlog。
3. 为判题服务建立最小 E2E 流程：手动触发任务、查看结果写回。
4. 完成 admin-frontend 的登录页与基础布局，接入后端登录 API。

## 跟踪方式
- 采用 GitHub Projects 看板：Backlog / In Progress / Review / Done 四列。
- 每周末回顾：更新里程碑进度、调整优先级、记录技术债。
- 约定主干分支保护：提交前跑 `make check` + 关键服务单测；PR 需附带验证步骤与影响范围说明。
