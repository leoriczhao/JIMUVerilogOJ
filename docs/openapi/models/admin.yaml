components:
  schemas:
    AdminInfo:
      type: object
      properties:
        user_id:
          type: integer
        username:
          type: string
        role:
          type: string
        permissions:
          type: array
          items:
            type: string

    SystemStats:
      type: object
      properties:
        users:
          type: integer
        problems:
          type: integer
        submissions:
          type: integer
        judges_online:
          type: integer

    DashboardStats:
      type: object
      properties:
        total_users:
          type: integer
        active_users:
          type: integer
        total_problems:
          type: integer
        public_problems:
          type: integer
        total_submissions:
          type: integer
        recent_submissions:
          type: integer
        judges_online:
          type: integer
        judges_total:
          type: integer
        system_load:
          type: number
        memory_usage:
          type: number

    AdminUserList:
      type: object
      properties:
        users:
          type: array
          items:
            $ref: '../models/user.yaml#/components/schemas/User'
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer

    AdminUserDetail:
      allOf:
        - $ref: '../models/user.yaml#/components/schemas/User'
        - type: object
          properties:
            submission_stats:
              type: object
              properties:
                total:
                  type: integer
                accepted:
                  type: integer
                acceptance_rate:
                  type: number
            login_history:
              type: array
              items:
                type: object
                properties:
                  ip:
                    type: string
                  timestamp:
                    type: string
                    format: date-time

    CreateUserRequest:
      type: object
      required:
        - username
        - email
        - password
        - role
      properties:
        username:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
        nickname:
          type: string
        role:
          type: string
          enum: [student, teacher, admin]
        school:
          type: string
        student_id:
          type: string

    UpdateUserRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        nickname:
          type: string
        role:
          type: string
          enum: [student, teacher, admin]
        school:
          type: string
        student_id:
          type: string
        is_active:
          type: boolean

    BanUserRequest:
      type: object
      required:
        - reason
      properties:
        reason:
          type: string
        duration:
          type: integer
          description: 封禁天数，0表示永久封禁

    AdminSubmissionList:
      type: object
      properties:
        submissions:
          type: array
          items:
            $ref: '../models/submission.yaml#/components/schemas/Submission'
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer

    AdminSubmissionDetail:
      allOf:
        - $ref: '../models/submission.yaml#/components/schemas/Submission'
        - type: object
          properties:
            judge_log:
              type: string
            test_results:
              type: array
              items:
                type: object
                properties:
                  test_case_id:
                    type: integer
                  status:
                    type: string
                  time_used:
                    type: integer
                  memory_used:
                    type: integer
                  error_message:
                    type: string

    AdminProblemList:
      type: object
      properties:
        problems:
          type: array
          items:
            $ref: '../models/problem.yaml#/components/schemas/Problem'
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer

    AdminProblemDetail:
      allOf:
        - $ref: '../models/problem.yaml#/components/schemas/Problem'
        - type: object
          properties:
            test_cases:
              type: array
              items:
                type: object
                properties:
                  input:
                    type: string
                  output:
                    type: string
                  is_sample:
                    type: boolean
            recent_submissions:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: integer
                  user:
                    $ref: '../models/user.yaml#/components/schemas/User'
                  status:
                    type: string
                  created_at:
                    type: string
                    format: date-time

    AdminCreateProblemRequest:
      type: object
      required:
        - title
        - description
      properties:
        title:
          type: string
        description:
          type: string
        input_desc:
          type: string
        output_desc:
          type: string
        difficulty:
          type: string
          enum: [Easy, Medium, Hard]
        category:
          type: string
        tags:
          type: array
          items:
            type: string
        time_limit:
          type: integer
          default: 1000
        memory_limit:
          type: integer
          default: 128
        is_public:
          type: boolean
          default: false
        test_cases:
          type: array
          items:
            type: object
            properties:
              input:
                type: string
              output:
                type: string
              is_sample:
                type: boolean

    AdminUpdateProblemRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        input_desc:
          type: string
        output_desc:
          type: string
        difficulty:
          type: string
          enum: [Easy, Medium, Hard]
        category:
          type: string
        tags:
          type: array
          items:
            type: string
        time_limit:
          type: integer
        memory_limit:
          type: integer
        is_public:
          type: boolean

    AdminNewsList:
      type: object
      properties:
        news:
          type: array
          items:
            $ref: '../models/news.yaml#/components/schemas/News'
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer

    AdminNewsDetail:
      allOf:
        - $ref: '../models/news.yaml#/components/schemas/News'
        - type: object
          properties:
            view_count:
              type: integer
            like_count:
              type: integer

    AdminCreateNewsRequest:
      type: object
      required:
        - title
        - content
      properties:
        title:
          type: string
        content:
          type: string
        summary:
          type: string
        category:
          type: string
        tags:
          type: array
          items:
            type: string
        is_published:
          type: boolean
          default: false

    AdminUpdateNewsRequest:
      type: object
      properties:
        title:
          type: string
        content:
          type: string
        summary:
          type: string
        category:
          type: string
        tags:
          type: array
          items:
            type: string
        is_published:
          type: boolean

    AdminForumPostList:
      type: object
      properties:
        posts:
          type: array
          items:
            $ref: '../models/forum.yaml#/components/schemas/ForumPost'
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer

    AdminForumPostDetail:
      allOf:
        - $ref: '../models/forum.yaml#/components/schemas/ForumPost'
        - type: object
          properties:
            recent_replies:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: integer
                  content:
                    type: string
                  user:
                    $ref: '../models/user.yaml#/components/schemas/User'
                  created_at:
                    type: string
                    format: date-time