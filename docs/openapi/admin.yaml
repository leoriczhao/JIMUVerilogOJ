openapi: 3.0.3
info:
  title: Verilog OJ Admin API
  description: Verilog在线判题系统管理员API
  version: 1.0.0
  contact:
    name: API Support
    email: support@verilog-oj.com
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://localhost:8080/api/v1
    description: 开发环境
  - url: https://api.verilog-oj.com/api/v1
    description: 生产环境

# 引用组件定义
components:
  $ref: './models/common.yaml#/components'

  # 补充特定于admin的schemas
  schemas:
    # 批量角色分配
    BulkRoleAssignment:
      type: object
      properties:
        user_ids:
          type: array
          items:
            type: integer
          description: 用户ID列表
        role:
          $ref: '#/components/schemas/UserRole'
        reason:
          type: string
          description: 分配原因
      required: [user_ids, role]

paths:
  # 管理员身份验证
  /admin/whoami:
    get:
      tags:
        - 管理员身份
      summary: 当前管理员信息
      security:
        - BearerAuth: []
      x-rbac-roles: [admin, super_admin]
      description: 需要管理员角色
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/AdminInfo'
        '401':
          description: 未认证
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  # 系统统计
  /admin/stats:
    get:
      tags:
        - 系统统计
      summary: 系统统计信息
      security:
        - BearerAuth: []
      x-rbac-permissions: [stats.admin]
      description: 需要管理员统计权限
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/SystemStats'
        '401':
          description: 未认证
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'
        '403':
          description: 权限不足 - 需要 stats.admin 权限
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/stats/dashboard:
    get:
      tags:
        - 系统统计
      summary: 管理面板数据
      security:
        - BearerAuth: []
      x-rbac-permissions: [stats.admin]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/DashboardStats'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  # 用户管理
  /admin/users:
    get:
      tags:
        - 用户管理
      summary: 获取用户列表
      security:
        - BearerAuth: []
      x-rbac-permissions: [manage.users]
      description: 需要用户管理权限
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: role
          in: query
          schema:
            type: string
            enum: [student, teacher, admin, super_admin]
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive]
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/AdminUserList'
        '403':
          description: 权限不足 - 需要 manage.users 权限
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

    post:
      tags:
        - 用户管理
      summary: 创建用户
      security:
        - BearerAuth: []
      x-rbac-permissions: [user.create]
      description: 需要用户创建权限
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/admin.yaml#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: './models/user.yaml#/components/schemas/User'
        '403':
          description: 权限不足 - 需要 user.create 权限
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/users/{id}:
    get:
      tags:
        - 用户管理
      summary: 获取用户详情
      security:
        - BearerAuth: []
      x-rbac-permissions: [user.read]
      description: 需要用户读取权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/AdminUserDetail'
        '403':
          description: 权限不足 - 需要 user.read 权限
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

    put:
      tags:
        - 用户管理
      summary: 更新用户信息
      security:
        - BearerAuth: []
      x-rbac-permissions: [user.update]
      description: 需要 user.update 权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/admin.yaml#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: 更新成功
        '403':
          description: 权限不足 - 需要 user.update 权限
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

    delete:
      tags:
        - 用户管理
      summary: 删除用户
      security:
        - BearerAuth: []
      x-rbac-permissions: [user.delete]
      description: 需要 user.delete 权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 删除成功
        '403':
          description: 权限不足 - 需要 user.delete 权限
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/users/{id}/ban:
    post:
      tags:
        - 用户管理
      summary: 封禁用户
      security:
        - BearerAuth: []
      x-rbac-permissions: [user.ban]
      description: 需要 user.ban 权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/admin.yaml#/components/schemas/BanUserRequest'
      responses:
        '200':
          description: 封禁成功
        '403':
          description: 权限不足 - 需要 user.ban 权限
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/users/{id}/unban:
    post:
      tags:
        - 用户管理
      summary: 解封用户
      security:
        - BearerAuth: []
      x-rbac-permissions: [user.unban]
      description: 需要 user.unban 权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 解封成功
        '403':
          description: 权限不足 - 需要 user.unban 权限
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/users/{id}/role:
    put:
      tags:
        - 用户管理
      summary: 更新用户角色
      security:
        - BearerAuth: []
      x-rbac-permissions: [manage.roles]
      description: 需要角色管理权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 用户ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                role:
                  $ref: '#/components/schemas/UserRole'
                reason:
                  type: string
                  description: 角色变更原因
              required: [role]
              example:
                role: "teacher"
                reason: "升级为教师权限"
      responses:
        '200':
          description: 角色更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserInfo'
        '403':
          description: 权限不足 - 需要 manage.roles 权限
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'
        '404':
          description: 用户不存在
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/users/roles/bulk:
    post:
      tags:
        - 用户管理
      summary: 批量分配角色
      security:
        - BearerAuth: []
      x-rbac-permissions: [manage.roles]
      description: 需要角色管理权限
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkRoleAssignment'
      responses:
        '200':
          description: 批量分配成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success_count:
                    type: integer
                    description: 成功分配数量
                  failed_count:
                    type: integer
                    description: 失败分配数量
                  failed_users:
                    type: array
                    items:
                      type: object
                      properties:
                        user_id:
                          type: integer
                        error:
                          type: string
        '403':
          description: 权限不足 - 需要 manage.roles 权限
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/roles:
    get:
      tags:
        - 用户管理
      summary: 获取角色列表
      security:
        - BearerAuth: []
      x-rbac-permissions: [manage.roles]
      description: 需要角色管理权限
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  roles:
                  type: array
                  items:
                    $ref: '#/components/schemas/RoleInfo'
        '403':
          description: 权限不足 - 需要 manage.roles 权限
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/roles/stats:
    get:
      tags:
        - 用户管理
      summary: 获取角色统计信息
      security:
        - BearerAuth: []
      x-rbac-permissions: [stats.read]
      description: 需要统计读取权限
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_users:
                    type: integer
                    description: 总用户数
                  role_stats:
                    type: array
                    items:
                      $ref: '#/components/schemas/RoleStats'
                  updated_at:
                    type: string
                    format: date-time
                    description: 统计更新时间
        '403':
          description: 权限不足 - 需要 stats.read 权限
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/roles/{role}/permissions:
    get:
      tags:
        - 用户管理
      summary: 获取角色权限映射
      security:
        - BearerAuth: []
      x-rbac-permissions: [manage.roles]
      description: 需要角色管理权限
      parameters:
        - name: role
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/UserRole'
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RolePermissionMapping'
        '403':
          description: 权限不足 - 需要 manage.roles 权限
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  # 提交管理
  /admin/submissions:
    get:
      tags:
        - 提交管理
      summary: 获取提交记录列表
      security:
        - BearerAuth: []
      x-rbac-permissions: [submission.read]
      description: 需要提交读取权限
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: user_id
          in: query
          schema:
            type: integer
        - name: problem_id
          in: query
          schema:
            type: integer
        - name: status
          in: query
          schema:
            type: string
        - name: date_from
          in: query
          schema:
            type: string
            format: date
        - name: date_to
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/AdminSubmissionList'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/submissions/{id}:
    get:
      tags:
        - 提交管理
      summary: 获取提交详情
      security:
        - BearerAuth: []
      x-rbac-permissions: [submission.read]
      description: 需要提交读取权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/AdminSubmissionDetail'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

    delete:
      tags:
        - 提交管理
      summary: 删除提交记录
      security:
        - BearerAuth: []
      x-rbac-permissions: [submission.delete]
      description: 需要提交删除权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 删除成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/submissions/{id}/rejudge:
    post:
      tags:
        - 提交管理
      summary: 重新判题
      security:
        - BearerAuth: []
      x-rbac-permissions: [submission.rejudge]
      description: 需要重新判题权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 重新判题已启动
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  # 题目管理
  /admin/problems:
    get:
      tags:
        - 题目管理
      summary: 获取题目列表
      security:
        - BearerAuth: []
      x-rbac-permissions: [problem.read]
      description: 需要题目读取权限
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: difficulty
          in: query
          schema:
            type: string
            enum: [Easy, Medium, Hard]
        - name: status
          in: query
          schema:
            type: string
            enum: [public, private, draft]
        - name: author_id
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/AdminProblemList'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

    post:
      tags:
        - 题目管理
      summary: 创建题目
      security:
        - BearerAuth: []
      x-rbac-permissions: [problem.create]
      description: 需要题目创建权限
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/admin.yaml#/components/schemas/AdminCreateProblemRequest'
      responses:
        '201':
          description: 创建成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/problems/{id}:
    get:
      tags:
        - 题目管理
      summary: 获取题目详情
      security:
        - BearerAuth: []
      x-rbac-permissions: [problem.read]
      description: 需要题目读取权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/AdminProblemDetail'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

    put:
      tags:
        - 题目管理
      summary: 更新题目
      security:
        - BearerAuth: []
      x-rbac-require:
        permissions: [problem.update.own]
        roles: [admin, super_admin]
        operator: "OR"
      description: 需要题目更新权限（自己的题目）或管理员权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/admin.yaml#/components/schemas/AdminUpdateProblemRequest'
      responses:
        '200':
          description: 更新成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

    delete:
      tags:
        - 题目管理
      summary: 删除题目
      security:
        - BearerAuth: []
      x-rbac-require:
        permissions: [problem.delete.own]
        roles: [admin, super_admin]
        operator: "OR"
      description: 需要题目删除权限（自己的题目）或管理员权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 删除成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/problems/{id}/publish:
    post:
      tags:
        - 题目管理
      summary: 发布题目
      security:
        - BearerAuth: []
      x-rbac-permissions: [problem.publish]
      description: 需要题目发布权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 发布成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/problems/{id}/archive:
    post:
      tags:
        - 题目管理
      summary: 归档题目
      security:
        - BearerAuth: []
      x-rbac-permissions: [problem.archive]
      description: 需要题目归档权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 归档成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  # 新闻管理
  /admin/news:
    get:
      tags:
        - 新闻管理
      summary: 获取新闻列表
      security:
        - BearerAuth: []
      x-rbac-permissions: [news.read]
      description: 需要新闻读取权限
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: status
          in: query
          schema:
            type: string
            enum: [published, draft, archived]
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/AdminNewsList'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

    post:
      tags:
        - 新闻管理
      summary: 创建新闻
      security:
        - BearerAuth: []
      x-rbac-permissions: [news.create]
      description: 需要新闻创建权限
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/admin.yaml#/components/schemas/AdminCreateNewsRequest'
      responses:
        '201':
          description: 创建成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/news/{id}:
    get:
      tags:
        - 新闻管理
      summary: 获取新闻详情
      security:
        - BearerAuth: []
      x-rbac-permissions: [news.read]
      description: 需要新闻读取权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/AdminNewsDetail'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

    put:
      tags:
        - 新闻管理
      summary: 更新新闻
      security:
        - BearerAuth: []
      x-rbac-permissions: [news.update]
      description: 需要新闻更新权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/admin.yaml#/components/schemas/AdminUpdateNewsRequest'
      responses:
        '200':
          description: 更新成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

    delete:
      tags:
        - 新闻管理
      summary: 删除新闻
      security:
        - BearerAuth: []
      x-rbac-permissions: [news.delete]
      description: 需要新闻删除权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 删除成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/news/{id}/publish:
    post:
      tags:
        - 新闻管理
      summary: 发布新闻
      security:
        - BearerAuth: []
      x-rbac-permissions: [news.publish]
      description: 需要新闻发布权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 发布成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/news/{id}/archive:
    post:
      tags:
        - 新闻管理
      summary: 归档新闻
      security:
        - BearerAuth: []
      x-rbac-permissions: [news.archive]
      description: 需要新闻归档权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 归档成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  # 论坛管理
  /admin/forum/posts:
    get:
      tags:
        - 论坛管理
      summary: 获取帖子列表
      security:
        - BearerAuth: []
      x-rbac-permissions: [forum.moderate]
      description: 需要论坛管理权限
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: status
          in: query
          schema:
            type: string
            enum: [normal, hidden, locked]
        - name: user_id
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/AdminForumPostList'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/forum/posts/{id}:
    get:
      tags:
        - 论坛管理
      summary: 获取帖子详情
      security:
        - BearerAuth: []
      x-rbac-permissions: [forum.moderate]
      description: 需要论坛管理权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/AdminForumPostDetail'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

    delete:
      tags:
        - 论坛管理
      summary: 删除帖子
      security:
        - BearerAuth: []
      x-rbac-permissions: [forum.delete]
      description: 需要论坛删除权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 删除成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/forum/posts/{id}/lock:
    post:
      tags:
        - 论坛管理
      summary: 锁定帖子
      security:
        - BearerAuth: []
      x-rbac-permissions: [forum.post.lock]
      description: 需要帖子锁定权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 锁定成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/forum/posts/{id}/unlock:
    post:
      tags:
        - 论坛管理
      summary: 解锁帖子
      security:
        - BearerAuth: []
      x-rbac-permissions: [forum.post.lock]
      description: 需要帖子锁定权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 解锁成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/forum/posts/{id}/sticky:
    post:
      tags:
        - 论坛管理
      summary: 置顶帖子
      security:
        - BearerAuth: []
      x-rbac-permissions: [forum.post.sticky]
      description: 需要帖子置顶权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 置顶成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/forum/posts/{id}/unsticky:
    post:
      tags:
        - 论坛管理
      summary: 取消置顶帖子
      security:
        - BearerAuth: []
      x-rbac-permissions: [forum.post.sticky]
      description: 需要帖子置顶权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 取消置顶成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  # 系统配置
  /admin/settings:
    get:
      tags:
        - 系统配置
      summary: 获取系统配置
      security:
        - BearerAuth: []
      x-rbac-permissions: [manage.config]
      description: 需要系统配置权限
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/SystemSettings'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

    put:
      tags:
        - 系统配置
      summary: 更新系统配置
      security:
        - BearerAuth: []
      x-rbac-permissions: [manage.config]
      description: 需要系统配置权限
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './models/admin.yaml#/components/schemas/UpdateSystemSettingsRequest'
      responses:
        '200':
          description: 更新成功
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  # 判题服务管理
  /admin/judges:
    get:
      tags:
        - 判题服务
      summary: 获取判题服务列表
      security:
        - BearerAuth: []
      x-rbac-permissions: [manage.system]
      description: 需要系统管理权限
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/JudgeServiceList'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'

  /admin/judges/{id}:
    get:
      tags:
        - 判题服务
      summary: 获取判题服务详情
      security:
        - BearerAuth: []
      x-rbac-permissions: [manage.system]
      description: 需要系统管理权限
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './models/admin.yaml#/components/schemas/JudgeServiceDetail'
        '403':
          description: 权限不足
          content:
            application/json:
              schema:
                $ref: './models/common.yaml#/components/schemas/Error'